<div class="space-y-6">
  <!-- Header -->
  <div>
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Reportes y Boletas</h1>
    <p class="text-sm sm:text-base text-gray-600 mt-1 sm:mt-2">Genera reportes de calificaciones para imprimir</p>
  </div>

  <!-- Filtros (Ocultos en impresión) -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 print:hidden">
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-base font-semibold text-gray-900 mb-4">Seleccionar Alumno</h3>
      <select
        [value]="selectedAlumno()"
        (change)="onAlumnoChange($any($event.target).value)"
        class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
      >
        <option *ngFor="let alumno of alumnosOrdenados()" [value]="alumno.id">
          {{ alumno.apellidoPaterno }} {{ alumno.apellidoMaterno }} {{ alumno.nombre }}
        </option>
      </select>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-base font-semibold text-gray-900 mb-4">Periodo</h3>
      <select
        [value]="selectedPeriodo()"
        (change)="onPeriodoChange($any($event.target).value)"
        class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
      >
        <option value="1">Primer Periodo</option>
        <option value="2">Segundo Periodo</option>
        <option value="3">Tercer Periodo</option>
      </select>
    </div>
  </div>

  <!-- Botones de acción (Ocultos en impresión) -->
  <div class="flex gap-2 print:hidden">
    <button
      (click)="handleImprimir()"
      class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
    >
      <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
      </svg>
      Imprimir Boleta
    </button>
    <button
      (click)="handleDescargar()"
      class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
    >
      <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
      </svg>
      Descargar PDF
    </button>
  </div>

  <!-- Boleta de Calificaciones -->
  <div id="report-content" class="bg-white">
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <!-- Header de la boleta -->
      <div class="px-6 py-4 border-b-2 border-indigo-600 bg-white">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-900">Boleta de Calificaciones</h2>
            <p class="text-sm text-gray-500 mt-1">Ciclo Escolar 2024-2025</p>
          </div>
          <svg class="h-12 w-12 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
      </div>

      <!-- Contenido de la boleta -->
      <div class="p-6 space-y-6">
        <!-- Información del alumno -->
        <div class="grid grid-cols-2 gap-4 pb-4 border-b border-gray-200">
          <div>
            <p class="text-sm text-gray-600 font-medium">Nombre del Alumno:</p>
            <p class="text-base text-gray-900">
              {{ alumnoActual()?.nombre }} {{ alumnoActual()?.apellidoPaterno }} {{ alumnoActual()?.apellidoMaterno }}
            </p>
          </div>
          <div>
            <p class="text-sm text-gray-600 font-medium">Grado y Grupo:</p>
            <p class="text-base text-gray-900">{{ alumnoActual()?.grado }}° {{ alumnoActual()?.grupo }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-600 font-medium">Periodo:</p>
            <p class="text-base text-gray-900">{{ getPeriodoTexto(selectedPeriodo()) }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-600 font-medium">Fecha de Emisión:</p>
            <p class="text-base text-gray-900">{{ fechaEmision() }}</p>
          </div>
        </div>

        <!-- Tabla de calificaciones -->
        <div>
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Calificaciones por Materia</h3>
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Materia
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Calificación
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Estado
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let item of calificacionesPorMateria()">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  {{ item.materia }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-900">
                  {{ item.promedio }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center text-sm">
                  <span
                    [class.text-green-600]="item.estado === 'Aprobado'"
                    [class.text-red-600]="item.estado === 'Reprobado'"
                    [class.text-gray-500]="item.estado === 'Sin Calificar'"
                    class="font-medium"
                  >
                    {{ item.estado }}
                  </span>
                </td>
              </tr>
              <!-- Fila de promedio general -->
              <tr class="border-t-2 border-gray-300 bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">
                  Promedio General
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-bold text-gray-900">
                  {{ promedioGeneral() !== null ? promedioGeneral()!.toFixed(1) : 'S/C' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-bold">
                  <span
                    [class.text-green-600]="promedioGeneral() !== null && promedioGeneral()! >= 6"
                    [class.text-red-600]="promedioGeneral() !== null && promedioGeneral()! < 6"
                    [class.text-gray-500]="promedioGeneral() === null"
                  >
                    <ng-container *ngIf="promedioGeneral() !== null; else sinCalificar">
                      {{ promedioGeneral()! >= 6 ? 'Aprobado' : 'Reprobado' }}
                    </ng-container>
                    <ng-template #sinCalificar>Sin Calificar</ng-template>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Firmas -->
        <div class="pt-6 border-t border-gray-200">
          <div class="grid grid-cols-2 gap-8">
            <div class="text-center">
              <div class="border-t-2 border-gray-400 pt-2 mt-12">
                <p class="text-sm text-gray-700 font-medium">Firma del Docente</p>
              </div>
            </div>
            <div class="text-center">
              <div class="border-t-2 border-gray-400 pt-2 mt-12">
                <p class="text-sm text-gray-700 font-medium">Firma del Director</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="text-xs text-gray-500 text-center pt-4 border-t border-gray-200">
          <p class="font-medium">Educacion Basica/Media - Sistema Gradix</p>
          <p class="mt-1">Este documento es oficial y tiene validez académica</p>
        </div>
      </div>
    </div>
  </div>
</div>
